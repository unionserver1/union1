<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VMC</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --color-bg-primary: #121212;
            --color-bg-secondary: #1f1f1f;
            --color-bg-card: #2c2c2c;
            --color-text-primary: #e0e0e0;
            --color-text-secondary: #a0a0a0;
            --color-accent: #3b82f6;
            --color-accent-hover: #2563eb;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-border: #444;
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .hidden {
            display: none !important;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background-color: var(--color-bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background-color: var(--color-bg-card);
            border-bottom: 1px solid var(--color-border);
        }

        .app-header__logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent);
        }
        
        .app-header__info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .app-header__info span {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
        }

        .app-header__info strong {
            color: var(--color-text-primary);
        }

        .app-header__logout-btn {
            background: none;
            border: none;
            color: var(--color-accent);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .app-header__logout-btn:hover {
            text-decoration: underline;
        }

        .app-main {
            display: flex;
            flex: 1;
        }
        
        .inbox-panel {
            flex-basis: 350px;
            min-width: 300px;
            background-color: var(--color-bg-secondary);
            border-right: 1px solid var(--color-border);
            padding: 1.5rem;
            overflow-y: auto;
            position: relative;
        }
        
        .email-panel {
            flex: 1;
            padding: 1.5rem;
            background-color: var(--color-bg-primary);
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .app-container {
                border-radius: 0;
            }
            .app-main {
                flex-direction: column;
                position: relative;
                overflow: hidden;
            }
            .inbox-panel, .email-panel {
                width: 100%;
                min-width: auto;
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                transition: transform 0.3s ease-in-out;
                border-right: none;
            }
            .inbox-panel {
                transform: translateX(0);
            }
            .inbox-panel.hidden-mobile {
                transform: translateX(-100%);
            }
            .email-panel {
                transform: translateX(100%);
            }
            .email-panel.active-mobile {
                transform: translateX(0);
            }
        }
        
        .email-list {
            list-style: none;
            padding: 0;
        }
        
        .email-list__item {
            background-color: var(--color-bg-card);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .email-list__item:hover {
            background-color: #383838;
        }
        
        .email-list__item--active {
            outline: 2px solid var(--color-accent);
            background-color: #383838;
        }
        
        .email-list__subject {
            font-weight: 600;
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .email-list__from {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        .email-details__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .email-details__back-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            display: none;
        }

        @media (max-width: 768px) {
            .email-details__back-btn {
                display: block;
            }
        }

        .email-details__subject {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .email-details__from {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            margin-bottom: 1.5rem;
        }

        .email-details__body {
            background-color: var(--color-bg-card);
            padding: 1.5rem;
            border-radius: 8px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 1rem;
        }
        
        .email-details__reply-btn {
            background-color: var(--color-accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
            transition: background-color 0.2s;
        }
        
        .email-details__reply-btn:hover {
            background-color: var(--color-accent-hover);
        }

        .compose-form {
            background-color: var(--color-bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        .compose-form__title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .compose-form__input,
        .compose-form__textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg-card);
            color: var(--color-text-primary);
            font-size: 1rem;
        }
        
        .compose-form__input:focus,
        .compose-form__textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }
        
        .compose-form__btn {
            background-color: var(--color-success);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .compose-form__btn:hover {
            background-color: #0b936a;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--color-bg-primary);
        }
        
        .login-box {
            background-color: var(--color-bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box__title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        
        .login-box__error {
            color: var(--color-error);
            font-size: 0.8rem;
            min-height: 1.5rem;
        }
        
        .login-box__input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-bg-card);
            color: var(--color-text-primary);
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        
        .login-box__input:focus {
            outline: none;
            border-color: var(--color-accent);
        }
        
        .login-box__btn {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--color-accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .login-box__btn:hover {
            background-color: var(--color-accent-hover);
        }

        .compose-btn-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }

        .compose-btn {
            background-color: var(--color-accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }

        .compose-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>

    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1 class="login-box__title">VMC Login</h1>
            <div class="login-box__error" id="loginError"></div>
            <input class="login-box__input" type="text" id="username" placeholder="Username" />
            <input class="login-box__input" type="password" id="password" placeholder="Password" />
            <button class="login-box__btn" onclick="handleLogin()">Login</button>
        </div>
    </div>

    <div class="app-container hidden" id="app">
        <header class="app-header">
            <div class="app-header__logo">VMC</div>
            <div class="app-header__info">
                <span>Bonds: <strong id="bondCount">0</strong></span>
                <span>User: <strong id="currentUser"></strong></span>
                <button class="app-header__logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </header>
        <main class="app-main">
            <div class="inbox-panel" id="inboxPanel">
                <h2>Inbox</h2>
                <ul class="email-list" id="inboxList"></ul>
            </div>
            <div class="email-panel" id="emailPanel">
                <div class="email-details" id="emailDetails">
                    <p>Select an email to view its contents.</p>
                </div>

                <form id="composeForm" class="compose-form hidden" action="https://formsubmit.co/sgburner23@outlook.com" method="POST">
                    <h3 class="compose-form__title">Compose Email</h3>
                    
                    <input type="hidden" name="_next" value="https://unionserver1.github.io/union1/" />
                    <input type="hidden" name="_captcha" value="false" />
                    <input type="hidden" name="_template" value="table" />
                    
                    <input type="hidden" name="name" id="formName" />
                    <input class="compose-form__input" type="text" name="recipient" id="formRecipient" placeholder="Recipient Name and Group (Vander@Union)" required />
                    <input class="compose-form__input" type="text" name="subject" id="formSubject" placeholder="Subject" required />
                    <textarea class="compose-form__textarea" name="message" id="formMessage" rows="6" placeholder="Write your message here..." required></textarea>
                    
                    <button class="compose-form__btn" type="submit">Send Email</button>
                </form>
            </div>
        </main>

        <div class="compose-btn-container">
            <button class="compose-btn" onclick="showComposeForm()">+</button>
        </div>
    </div>

    <script>
        const users = {
            "Joan Of Arc": {
                password: "Sm9hbmE=",
                bonds: 2,
                emails: [
                    { id: 1, from: "Suon@SGR", subject: "Welcome", body: "Welcome to the SGR." },
                    { id: 2, from: "Lotto@Facte", subject: "Daily Ad by Union", body: "Upgrade and pay 3 bonds a week for no ad mail. Hello People, just like to remind you all that Facte has a lottery open to every one this week. Pay up to 1000 bonds to earn up to 10 times more!" },
                    { id: 3, from: "BettingCo@Facte", subject: "Daily Ad by Union", body: "Message BettingCo@Facte '815' and earn 10 bonds to bet on this weeks event for free!" },
                    { id: 4, from: "Wind@SGR", subject: "Job Offer", body: "Hey Joan, since you are new here and I got a few Bonds I'd pay you to convince people to join the SGR. I'd give you 10 message addresses of potental recruits and I'd pay 3 bonds per recruit. Giving you a chance to prove your worth." },
                    { id: 5, from: "Wind@SGR", subject: "Job Offer Reply", body: "Great, here are the first 4: David@Caps Sticky@CM Sideways@Caps King@Union" },

                ],
            },
            "Vander": {
                password: "VW5pb24=",
                bonds: 500,
                emails: [
                    { id: 1, from: "Syndicate@Unknown", subject: "Status Report", body: "Provide a status report on the Joan of Arc asset immediately." },
                ],
            },
        };

        let currentUserData = null;
        let loggedInUsername = '';

        const inboxPanel = document.getElementById('inboxPanel');
        const emailPanel = document.getElementById('emailPanel');
        const composeForm = document.getElementById('composeForm');
        const emailDetails = document.getElementById('emailDetails');

        // --- Core App & Session Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            const passwordInput = document.getElementById('password');
            passwordInput.addEventListener('keyup', (event) => {
                if (event.key === "Enter") {
                    handleLogin();
                }
            });
        });

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('loggedInVMCUser');
            if (savedUser && users[savedUser]) {
                loggedInUsername = savedUser;
                currentUserData = users[savedUser];
                loadApp(savedUser);
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('app').classList.add('hidden');
            }
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorDiv = document.getElementById('loginError');

            if (users[username] && atob(users[username].password) === password) {
                loggedInUsername = username;
                currentUserData = users[username];
                localStorage.setItem('loggedInVMCUser', username);
                errorDiv.textContent = '';
                loadApp(username);
            } else {
                errorDiv.textContent = 'Invalid username or password.';
            }
        }

        function handleLogout() {
            localStorage.removeItem('loggedInVMCUser');
            currentUserData = null;
            loggedInUsername = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }

        function loadApp(username) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('currentUser').textContent = username;
            updateHeader();
            renderInbox();
        }

        function updateHeader() {
            document.getElementById('bondCount').textContent = currentUserData.bonds;
        }

        // --- Email Rendering & Interaction ---
        function renderInbox() {
            const inboxList = document.getElementById("inboxList");
            inboxList.innerHTML = "";

            currentUserData.emails.sort((a, b) => b.id - a.id).forEach(email => {
                const li = document.createElement("li");
                li.className = "email-list__item";
                li.dataset.emailId = email.id;
                li.innerHTML = `
                    <span class="email-list__subject">${email.subject}</span>
                    <span class="email-list__from">From: ${email.from}</span>
                `;
                li.addEventListener('click', () => showEmail(email.id));
                inboxList.appendChild(li);
            });
        }

        function showEmail(emailId) {
            const email = currentUserData.emails.find(e => e.id === emailId);
            if (!email) return;

            document.querySelectorAll('.email-list__item').forEach(el => {
                el.classList.toggle('email-list__item--active', el.dataset.emailId == emailId);
            });
            
            composeForm.classList.add('hidden');
            emailDetails.classList.remove('hidden');

            emailDetails.innerHTML = `
                <div class="email-details__header">
                    <button class="email-details__back-btn" onclick="hideEmailDetails()">&lt;</button>
                    <h3 class="email-details__subject">${email.subject}</h3>
                </div>
                <p class="email-details__from">From: ${email.from}</p>
                <pre class="email-details__body">${email.body}</pre>
                <button class="email-details__reply-btn" onclick="replyToEmail(${email.id})">Reply</button>
            `;

            // Mobile view handling
            if (window.innerWidth <= 768) {
                inboxPanel.classList.add('hidden-mobile');
                emailPanel.classList.add('active-mobile');
            }
        }
        
        function hideEmailDetails() {
            emailPanel.classList.remove('active-mobile');
            inboxPanel.classList.remove('hidden-mobile');
        }

        function showComposeForm() {
            emailDetails.classList.add('hidden');
            composeForm.classList.remove('hidden');
            
            // Auto-fill and hide sender name field
            document.getElementById("formName").value = loggedInUsername;
            
            // Mobile view handling
            if (window.innerWidth <= 768) {
                inboxPanel.classList.add('hidden-mobile');
                emailPanel.classList.add('active-mobile');
            }

            document.getElementById("formRecipient").focus();
        }

        function replyToEmail(emailId) {
            const email = currentUserData.emails.find(e => e.id === emailId);
            if (!email) return;

            document.getElementById("formRecipient").value = email.from;
            document.getElementById("formSubject").value = "Re: " + email.subject;
            document.getElementById("formMessage").value = `\n\n--- Original Message ---\n> ${email.body.replace(/\n/g, '\n> ')}`;

            showComposeForm();
        }

        // --- Handle Form Submission (Internal) ---
        const form = document.getElementById('composeForm');
        form.addEventListener("submit", (e) => {
            const senderName = document.getElementById('formName').value;
            const recipientInfo = document.getElementById('formRecipient').value;
            const subject = document.getElementById('formSubject').value;
            const message = document.getElementById('formMessage').value;

            if (!senderName || !recipientInfo || !subject || !message) {
                alert("Please fill out all fields.");
                e.preventDefault();
                return;
            }

            const recipientName = recipientInfo.split('@')[0];
            
            if (users[recipientName]) {
                const recipient = users[recipientName];
                const newEmail = {
                    id: recipient.emails.length + 1,
                    from: `${senderName}@${currentUserData.group || 'Facte'}`,
                    subject: subject,
                    body: message,
                };
                recipient.emails.push(newEmail);
                
                alert(`Email successfully sent to ${recipientName}.`);

                form.reset();
                form.classList.add('hidden');
                
            }
        });
    </script>
</body>
</html>
