<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Union Service Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<style>/* --- contents of the original <style> block --- */
:root {
    --color-bg-primary: #121212;
    --color-bg-secondary: #1f1f1f;
    --color-bg-card: #2c2c2c;
    --color-text-primary: #e0e0e0;
    --color-text-secondary: #a0a0a0;
    --color-accent: #c80ccb;
    --color-accent-hover: #6b036d;
    --color-success: #10b9b9;
    --color-error: #d0ef44;
    --color-border: #444;
    --color-ad: white; /* Yellow color for AD */
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Inter', sans-serif;
    background-color: var(--color-bg-primary);
    color: var(--color-text-primary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.hidden {
    display: none !important;
}

.app-container {
    display: flex;
    flex-direction: column;
    flex: 1;
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    background-color: var(--color-bg-secondary);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.app-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background-color: var(--color-bg-card);
    border-bottom: 1px solid var(--color-border);
}

.app-header__logo {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-accent);
}

.app-header__info {
    display: flex;
    align-items: center;
    gap: 1rem;
  text-decoration: none;
}

.app-header__info span {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
      text-decoration: none;

}

.app-header__info strong {
    color: var(--color-text-primary);
      text-decoration: none;

}

.app-header__logout-btn {
    background: none;
    border: none;
    color: var(--color-accent);
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
}

.app-header__logout-btn:hover {
    text-decoration: underline;
}

.app-main {
    display: flex;
    flex: 1;
}

.inbox-panel {
    flex-basis: 350px;
    min-width: 300px;
    background-color: var(--color-bg-secondary);
    border-right: 1px solid var(--color-border);
    padding: 1.5rem;
    overflow-y: auto;
    position: relative;
}

.email-panel {
    flex: 1;
    padding: 1.5rem;
    background-color: var(--color-bg-primary);
    overflow-y: auto;
}

@media (max-width: 768px) {
    .app-container {
        border-radius: 0;
    }
    .app-main {
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }
    .inbox-panel, .email-panel {
        width: 100%;
        min-width: auto;
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        transition: transform 0.3s ease-in-out;
        border-right: none;
    }
    .inbox-panel {
        transform: translateX(0);
    }
    .inbox-panel.hidden-mobile {
        transform: translateX(-100%);
    }
    .email-panel {
        transform: translateX(100%);
    }
    .email-panel.active-mobile {
        transform: translateX(0);
    }
}

.email-list {
    list-style: none;
    padding: 0;
}

.email-list__item {
    background-color: var(--color-bg-card);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 0.8rem;
    cursor: pointer;
    transition: background-color 0.2s, opacity 0.2s;
}

.email-list__item:hover {
    background-color: #383838;
}

.email-list__item--active {
    outline: 2px solid var(--color-accent);
    background-color: #383838;
}

.email-list__item--read {
    opacity: 0.7;
}

.email-list__item--read:hover {
    opacity: 1;
}

.email-list__item--read .email-list__subject {
    font-weight: 500;
    color: var(--color-text-secondary);
}

.email-list__subject {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.25rem;
    transition: color 0.2s;
}

.email-list__item:not(.email-list__item--read) .email-list__subject::before {
    content: '';
    display: block;
    width: 10px;
    height: 10px;
    background-color: var(--color-accent);
    border-radius: 50%;
    flex-shrink: 0;
}

.email-list__from {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
}

.email-details__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.email-details__back-btn {
    background: none;
    border: none;
    color: var(--color-text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    display: none;
}

@media (max-width: 768px) {
    .email-details__back-btn {
        display: block;
    }
}

.email-details__subject {
    font-size: 1.5rem;
    font-weight: 600;
}

.email-details__from {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
}

.email-details__body {
    background-color: var(--color-bg-card);
    padding: 1.5rem;
    border-radius: 8px;
    line-height: 1.6;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 1rem;
}

.email-details__body h1,
.email-details__body h2,
.email-details__body h3 {
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    line-height: 1.2;
}

.email-details__body strong {
    color: var(--color-text-primary);
}

.email-details__reply-btn {
    background-color: var(--color-accent);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    margin-top: 1rem;
    transition: background-color 0.2s;
}

.email-details__reply-btn:hover {
    background-color: var(--color-accent-hover);
}

.compose-form {
    background-color: var(--color-bg-secondary);
    padding: 1.5rem;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 2rem;
}

.compose-form__title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.compose-form__input,
.compose-form__textarea {
    width: 100%;
    padding: 0.75rem;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    background-color: var(--color-bg-card);
    color: var(--color-text-primary);
    font-size: 1rem;
}

.compose-form__input:focus,
.compose-form__textarea:focus {
    outline: none;
    border-color: var(--color-accent);
}

.compose-form__btn {
    background-color: var(--color-success);
    color: white;
    padding: 1rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.compose-form__btn:hover {
    background-color: #0b936a;
}

.login-screen {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: var(--color-bg-primary);
}

.login-box {
    background-color: var(--color-bg-secondary);
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--shadow-md);
    width: 100%;
    max-width: 400px;
    text-align: center;
}

.login-box__title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
}

.login-box__error {
    color: var(--color-error);
    font-size: 0.8rem;
    min-height: 1.5rem;
}

.login-box__input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    background-color: var(--color-bg-card);
    color: var(--color-text-primary);
    margin-bottom: 1rem;
    font-size: 1rem;
}

.login-box__input:focus {
    outline: none;
    border-color: var(--color-accent);
}

.login-box__btn {
    width: 100%;
    padding: 0.75rem;
    background-color: var(--color-accent);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.login-box__btn:hover {
    background-color: var(--color-accent-hover);
}

.compose-btn-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 100;
}

.compose-btn {
    background-color: var(--color-accent);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s ease;
}

.compose-btn:hover {
    transform: scale(1.1);
}

.inbox-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.subscribe-btn {
    background-color: var(--color-accent);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.subscribe-btn:hover {
    background-color: var(--color-accent-hover);
}

.tiers-page {
    background-color: var(--color-bg-secondary);
}

.tiers-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    color: var(--color-text-primary);
}

.tiers-header h3 {
    font-size: 1.25rem;
}

.close-btn {
    background: none;
    border: none;
    color: var(--color-text-secondary);
    font-size: 1.75rem;
    cursor: pointer;
    line-height: 1;
}

.tiers-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.tier-card {
    background-color: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
}

.tier-card--pro {
    border-color: var(--color-ad);
    box-shadow: 0 0 15px rgba(234, 179, 8, 0.2);
}

.tier-card h4 {
    font-size: 1.1rem;
    color: var(--color-text-primary);
    margin-bottom: 0.5rem;
}

.tier-card .price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 1rem;
}

.tier-card .price .period {
    font-size: 0.9rem;
    font-weight: 400;
    color: var(--color-text-secondary);
}

.tier-card ul {
    list-style: none;
    margin-bottom: 1.5rem;
    flex-grow: 1;
}

.tier-card ul li {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.5rem;
    padding-left: 1.25rem;
    position: relative;
}

.tier-card ul li::before {
    content: '✓';
    color: var(--color-success);
    position: absolute;
    left: 0;
}

.tier-select-btn {
    background-color: var(--color-accent);
    color: white;
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
}

.tier-select-btn:hover {
    background-color: var(--color-accent-hover);
}
.ad-text {
    color: var(--color-ad);
    font-weight: 600;
}

.ad-slot {
    background-color: var(--color-bg-card);
    border: 1px dashed var(--color-ad);
    border-radius: 8px;
    padding: 0.75rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: background-color 0.2s;
    text-align: center;
}

.ad-slot:hover {
    background-color: #3a3a3a;
}

.ad-slot p {
    font-weight: 700;
    color: var(--color-ad);
    margin-bottom: 0.25rem;
}

.ad-slot span {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
}</style></head>
<body>

    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1 class="login-box__title">Union Service Hub Login</h1>
            <div class="login-box__error" id="loginError"></div>
            <input class="login-box__input" type="text" id="username" placeholder="Username" />
            <input class="login-box__input" type="password" id="password" placeholder="Password" />
            <button class="login-box__btn" id="loginBtn">Login</button>
        </div>
    </div>

    <div class="app-container hidden" id="app">
        <header class="app-header">
            <a href="" class="app-header__logo">USH</a>
            <div class="app-header__info" style="text-decoration: none;">
                <span>Bonds: <strong id="bondCount">0</strong></span>
                <span>E-Mail: <strong id="currentemail"></strong></span>
                <span>User: <strong id="currentUser"></strong></span>
                <button class="app-header__logout-btn" id="logoutBtn">Logout</button>
            </div>
        </header>
        <main class="app-main">
            <div class="inbox-panel" id="inboxPanel">
                <div class="inbox-header" id="inbox-header">
                    <h2>Inbox</h2>
                    <button class="subscribe-btn" id="upgradeBtn">Upgrade Now</button>
                </div>
                <div class="tiers-page hidden" id="tiersPage">
                    <div class="tiers-header">
                        <h3>USH Tiers</h3>
                        <button class="close-btn" id="closeTiersBtn">×</button>
                    </div>
                    <div class="tiers-grid">
                        <div class="tier-card">
                            <h4>Free</h4>
                            <p class="price">0 Bonds <span class="period">Ad Supported</span></p>
                            <ul>
                                <li>8 Emails</li>
                            </ul>
                        </div>
                        <div class="tier-card tier-card--pro">
                            <h4>Premium</h4>
                            <p class="price">120 Bonds <span class="period">/ month</span></p>
                            <ul>
                                <li>Unlimited Emails</li>
                                <li>Custom Themes</li>
                                <li>Faculte Internet</li>
                                <li>No Ads</li>
                                <li>Early Access to New Tools</li>
                                <li>And so much more</li>
                            </ul>
                            <button class="tier-select-btn" data-action="compose-ad" data-recipient="Sales@Union" data-subject="Upgrade to Pro">Upgrade</button>
                        </div>
                    </div>
                </div>
                <ul class="email-list" id="inboxList"></ul>
            </div>
            <div class="email-panel" id="emailPanel">
                <div id="emailDetails">
                    <p>Select an email to view its contents.</p>
                </div>
                <form id="composeForm" class="compose-form hidden" action="https://formsubmit.co/sgburner23@outlook.com" method="POST">
                    <h3 class="compose-form__title">Compose Email</h3>
                    <input type="hidden" name="_next" value="https://unionserver1.github.io/union1/" />
                    <input type="hidden" name="_captcha" value="false" />
                    <input type="hidden" name="_template" value="table" />
                    <input type="hidden" name="name" id="formName" />
                    <input class="compose-form__input" type="text" name="recipient" id="formRecipient" placeholder="Recipient Name and Group (Vander@Union)" required />
                    <input class="compose-form__input" type="text" name="subject" id="formSubject" placeholder="Subject" required />
                    <textarea class="compose-form__textarea" name="message" id="formMessage" rows="6" placeholder="Write your message here..." required></textarea>
                    <button class="compose-form__btn" type="submit">Send Email</button>
                </form>
            </div>
        </main>
        <div class="compose-btn-container">
            <button class="compose-btn" id="composeBtn">+</button>
        </div>
    </div>

    <script>document.addEventListener('DOMContentLoaded', () => {
    // --- USER DATA ---
    // User and email data is stored directly in the script.
    const usersData = {
        "Joan Of Arc": {
            password: "Sm9hbmE=",
            bonds: 182,
                        email: "Joan@SGR",

            emails: [
                { id: 56, from: "Faculte@SGR", subject: "Payment", body: "100 Bonds has been payed to you for your job as Leader of the SGR. " },
                { id: 57, from: "Rockefeller@Caps", subject: "Greetings", body: "Nice to talk to the leader of the SGR" },
                { id: 58, from: "Wind@SGR", subject: "What did I miss", body: "Fill me in from your side." },
                { id: 59, from: "ET@Move", subject: "Hello", body: "I think we have somethings you may be interested in. I will send the details to Suon." },
                { id: 60, from: "Faculte@SGR", subject: "Motions", body: "Two motions have been submitted today,$$$$Motion #5 To Disband the SGR by *Rockefeller*$$Turns the SGR group into a Faculte Run Corp.$$$$Motion #6 To Reform the Faculte into a union of states by *Fring*" },
                { id: 61, from: "Faculte@SGR", subject: "Motions", body: "One Motion has been submitted today,$$$$Motion #6 Set Tax to 2% by *Rockefeller* & *Fring*" },
                { id: 62, from: "Napoli@Caps", subject: "Agreed", body: "I am open for any ideas. I am working on something and will patch you in when I am done." },
                { id: 63, from: "Faculte@SGR", subject: "Report", body: "Please report your tax, current group, grade, and if you have moved groups in the last 35 Days. Failure to complete this will result in charges and removal from any Faculte Services." },
                { id: 57, from: "Rockefeller@Caps", subject: "Wanna Bet?", body: "Subject Line." },

            ],
        },
    };

    // --- STATE MANAGEMENT ---
    const state = {
        users: {},
        currentUser: null,
        currentemail: null,
        username: '',
        readIds: new Set(),
    };

    // --- DOM ELEMENTS ---
    const dom = {
        loginScreen: document.getElementById('loginScreen'),
        app: document.getElementById('app'),
        loginError: document.getElementById('loginError'),
        usernameInput: document.getElementById('username'),
        passwordInput: document.getElementById('password'),
        loginBtn: document.getElementById('loginBtn'),
        logoutBtn: document.getElementById('logoutBtn'),
        currentemailDisplay: document.getElementById('currentemail'),

        currentUserDisplay: document.getElementById('currentUser'),
        bondCountDisplay: document.getElementById('bondCount'),
        inboxPanel: document.getElementById('inboxPanel'),
        emailPanel: document.getElementById('emailPanel'),
        inboxList: document.getElementById('inboxList'),
        emailDetails: document.getElementById('emailDetails'),
        composeForm: document.getElementById('composeForm'),
        formName: document.getElementById('formName'),
        formRecipient: document.getElementById('formRecipient'),
        formSubject: document.getElementById('formSubject'),
        formMessage: document.getElementById('formMessage'),
        composeBtn: document.getElementById('composeBtn'),
        upgradeBtn: document.getElementById('upgradeBtn'),
        closeTiersBtn: document.getElementById('closeTiersBtn'),
        tiersPage: document.getElementById('tiersPage'),
        inboxHeader: document.getElementById('inbox-header'),
    };

    // --- LOCAL STORAGE HELPERS ---
    const storage = {
        getReadStatus: () => JSON.parse(localStorage.getItem('vmcReadStatus') || '{}'),
        saveReadStatus: (status) => localStorage.setItem('vmcReadStatus', JSON.stringify(status)),
        getLoggedInUser: () => localStorage.getItem('loggedInVMCUser'),
        setLoggedInUser: (username) => localStorage.setItem('loggedInVMCUser', username),
        clearLoggedInUser: () => localStorage.removeItem('loggedInVMCUser'),
    };

    // --- RENDERING & UI UPDATES ---
    const ui = {
        renderInbox: () => {
            dom.inboxList.innerHTML = "";
            const recentEmails = state.currentUser.emails
                .sort((a, b) => b.id - a.id)
                .slice(0, 5);

            recentEmails.forEach(email => {
                const li = document.createElement("li");
                li.className = "email-list__item";
                li.dataset.emailId = email.id;
                if (state.readIds.has(email.id)) {
                    li.classList.add('email-list__item--read');
                }
                li.innerHTML = `
                    <span class="email-list__subject">${email.subject}</span>
                    <span class="email-list__from">From: ${email.from}</span>
                `;
                dom.inboxList.appendChild(li);
            });
        },
        showEmail: (emailId) => {
            ui.hideTiersPage();
            const email = state.currentUser.emails.find(e => e.id === emailId);
            if (!email) return;

            if (!state.readIds.has(emailId)) {
                state.readIds.add(emailId);
                const readStatus = storage.getReadStatus();
                if (!readStatus[state.username]) readStatus[state.username] = {};
                readStatus[state.username].readIds = Array.from(state.readIds);
                storage.saveReadStatus(readStatus);
                ui.renderInbox();
            }

            document.querySelectorAll('.email-list__item').forEach(el => {
                el.classList.toggle('email-list__item--active', el.dataset.emailId == emailId);
            });
            
            dom.composeForm.classList.add('hidden');
            dom.emailDetails.classList.remove('hidden');

            const formattedBody = email.body
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\$\$/g, '<br>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');

            dom.emailDetails.innerHTML = `
                <div class="email-details__header">
                    <button class="email-details__back-btn" data-action="hide-email">&lt;</button>
                    <h3 class="email-details__subject">${email.subject}</h3>
                </div>
                <p class="email-details__from">From: ${email.from}</p>
                <div class="email-details__body">${formattedBody}</div>
                <button class="email-details__reply-btn" data-action="reply" data-email-id="${email.id}">Reply</button>
            `;

            if (window.innerWidth <= 768) {
                dom.inboxPanel.classList.add('hidden-mobile');
                dom.emailPanel.classList.add('active-mobile');
            }
        },
        showComposeForm: () => {
            ui.hideTiersPage();
            dom.emailDetails.classList.add('hidden');
            dom.composeForm.classList.remove('hidden');
            dom.formName.value = state.username;
            
            if (window.innerWidth <= 768) {
                dom.inboxPanel.classList.add('hidden-mobile');
                dom.emailPanel.classList.add('active-mobile');
            }
            dom.formRecipient.focus();
        },
        hideEmailDetails: () => {
            dom.emailPanel.classList.remove('active-mobile');
            dom.inboxPanel.classList.remove('hidden-mobile');
        },
        showTiersPage: () => {
            dom.inboxHeader.classList.add('hidden');
            dom.inboxList.classList.add('hidden');
            dom.tiersPage.classList.remove('hidden');
        },
        hideTiersPage: () => {
            dom.inboxHeader.classList.remove('hidden');
            dom.inboxList.classList.remove('hidden');
            dom.tiersPage.classList.add('hidden');
        },
        updateHeader: () => {
            dom.bondCountDisplay.textContent = state.currentUser.bonds;
            dom.currentUserDisplay.textContent = state.username;
            dom.currentemailDisplay.textContent = state.currentUser.email;
        },
        showApp: () => {
            dom.loginScreen.classList.add('hidden');
            dom.app.classList.remove('hidden');
            ui.updateHeader();
            ui.renderInbox();
        },
        showLogin: () => {
            dom.app.classList.add('hidden');
            dom.loginScreen.classList.remove('hidden');
            dom.usernameInput.value = '';
            dom.passwordInput.value = '';
        }
    };

    // --- EVENT HANDLERS ---
    const handlers = {
        handleLogin: () => {
            const username = dom.usernameInput.value.trim();
            const password = dom.passwordInput.value.trim();

            if (state.users[username] && atob(state.users[username].password) === password) {
                state.username = username;
                state.currentUser = state.users[username];
                storage.setLoggedInUser(username);
                
                const readStatus = storage.getReadStatus();
                const userStatus = readStatus[username] || {};
                state.readIds = new Set(userStatus.readIds || []);

                dom.loginError.textContent = '';
                ui.showApp();
            } else {
                dom.loginError.textContent = 'Invalid username or password.';
            }
        },
        handleLogout: () => {
            storage.clearLoggedInUser();
            state.currentUser = null;
            state.username = '';
            ui.showLogin();
        },
        checkLoginStatus: () => {
            const savedUser = storage.getLoggedInUser();
            if (savedUser && state.users[savedUser]) {
                state.username = savedUser;
                state.currentUser = state.users[savedUser];
                
                const readStatus = storage.getReadStatus();
                const userStatus = readStatus[savedUser] || {};
                state.readIds = new Set(userStatus.readIds || []);

                ui.showApp();
            } else {
                ui.showLogin();
            }
        },
        replyToEmail: (emailId) => {
            const email = state.currentUser.emails.find(e => e.id === emailId);
            if (!email) return;

            dom.formRecipient.value = email.from;
            dom.formSubject.value = "Replying to: " + email.subject;
            dom.formMessage.value = '';
            ui.showComposeForm();
        },
        fillAdEmail: (recipient, subject) => {
            ui.hideTiersPage();
            ui.showComposeForm();
            dom.formRecipient.value = recipient;
            dom.formSubject.value = subject;
            dom.formMessage.focus();
        }
    };

    // --- INITIALIZATION ---
    const init = () => {
        // Load user data directly into the state
        state.users = usersData;

        // Setup all event listeners
        dom.loginBtn.addEventListener('click', handlers.handleLogin);
        dom.passwordInput.addEventListener('keyup', (e) => e.key === "Enter" && handlers.handleLogin());
        dom.logoutBtn.addEventListener('click', handlers.handleLogout);
        dom.composeBtn.addEventListener('click', ui.showComposeForm);
        dom.upgradeBtn.addEventListener('click', ui.showTiersPage);
        dom.closeTiersBtn.addEventListener('click', ui.hideTiersPage);

        // Event delegation for dynamically created elements
        dom.inboxList.addEventListener('click', (e) => {
            const emailItem = e.target.closest('.email-list__item');
            if (emailItem) {
                const emailId = parseInt(emailItem.dataset.emailId, 10);
                ui.showEmail(emailId);
            }
        });

        dom.emailPanel.addEventListener('click', (e) => {
            const target = e.target;
            if (target.dataset.action === 'hide-email') {
                ui.hideEmailDetails();
            }
            if (target.dataset.action === 'reply') {
                const emailId = parseInt(target.dataset.emailId, 10);
                handlers.replyToEmail(emailId);
            }
        });
        
        dom.inboxPanel.addEventListener('click', (e) => {
            const adTarget = e.target.closest('[data-action="compose-ad"]');
            if (adTarget) {
                const { recipient, subject } = adTarget.dataset;
                handlers.fillAdEmail(recipient, subject);
            }
        });

        // Check if a user is already logged in
        handlers.checkLoginStatus();
    };

    // Start the application
    init();
});</script>
</body>
</html>
